<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <title>
cmu binary bomb phase 4 | david
</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">

<meta name="generator" content="Hugo 0.151.0">


<link rel="canonical" href="http://localhost:1313/posts/cmu-bb/cmu-bb-4/" >




<link href="/css/style.min.8c1bbfbfba9b690dde7acc6201b6f872da06ba79c6ba315ee30dce973958c5a6.css" rel="stylesheet">




</head>

<body>

    <div class="flexWrapper">
        <header class="headerWrapper">
    <div class="header">
        <div>
            <a class="terminal" href="/">
                <span>dav1dsec@blog ~ $</span>
            </a>
        </div>
        <input class="side-menu" type="checkbox" id="side-menu">
        <label class="hamb" for="side-menu"><span class="hamb-line"></span></label>
        <nav class="headerLinks">
            <ul>
                
                <li>
                    <a href="http://localhost:1313/categories/" title="" >
                        ~/categories</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/about/" title="" >
                        ~/about</a>
                </li>
                
                <li>
                    <a href="http://localhost:1313/posts/" title="" >
                        ~/posts</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


        <div class="content">
            <main class="main">
                
<div class="postWrapper">
    <h1>cmu binary bomb phase 4</h1>
    

    
    
    
    

    
    
    
    
    

    
    
    
    
    

    
    
    
    

    
    
    
    

    
    
    
    

    
    <section class="postMetadata">
        <dl>
            
                
<dt>tags</dt>
<dd><span></span>
    <a href="/tags/reverse-engineering/">#reverse-engineering</a></dd>
            
            
            
                
<dt>categories</dt>
<dd><span></span>
    <a href="/categories/cmu-binary-bomb/">cmu-binary-bomb</a></dd>
            
            
                <dt>published</dt>
                 
                 
                 <dd><time datetime="2024-08-16">2024-08-16</time></dd>
            
            
                <dt>reading time</dt>
                <dd>3 minutes</dd>
            
        </dl>
    </section>
    
    <div>
        <h3 id="phase-4">Phase 4!</h3>
<p>Here is a view of the <code>phase_4()</code> assembly code</p>
<p><img src="img/phase_4_func.png" alt="phase_4_asm"></p>
<p>For this phase, I decided to break out the reliable red dragon. Let&rsquo;s throw this into Ghidra and start inspecting the this function.</p>
<p><em>Note: I did step through the decompiled code and change some variable names and add comments for readability purposes</em></p>
<p><code>phase_4()</code> in Ghidra</p>
<p><img src="img/phase_4_func_Ghidra.png" alt="phase_4_ghidra"></p>
<p>First we are passing <code>sscanf()</code> pointer to our input, followed by our format string, followed by two buffers to store the extracted integers.</p>
<p><img src="img/sscanf_ghidra_view.png" alt="scanf_Ghidra">
<em>sscanf view in ghidra</em></p>
<p>Looking at our first &lsquo;if&rsquo; statement, there is 3 separate checks, any of which will result in an explosion. These are</p>
<ul>
<li>nums_entered != 2</li>
<li>buff_1[0] &lt; 0</li>
<li>0xe &lt; buff_1[0]</li>
</ul>
<p><img src="img/phase_4_first_if_statement_ghidra.png" alt="if_Ghidra"></p>
<p>Based on the constraints, we must pass in 2 integers, our first input cannot be less than zero or greater than e (14).</p>
<p>Seems easy enough. Here comes the fun.</p>
<p>Just before the second &lsquo;if&rsquo; statement, we have a few declarations</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>a <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>func4_ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">func4</span>(buff_1[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0xe</span>);
</span></span></code></pre></div><p>Followed by the second &lsquo;if&rsquo; in <code>phase_4()</code> which checks that</p>
<ul>
<li>func4_ret != a</li>
<li>buff_2[0] != a</li>
</ul>
<p><img src="img/final_if_statement_ghidra.png" alt="second_if_Ghidra"></p>
<p>According to the second set of constraints,  both <code>func4_ret</code> and buff_2[0] must == 10. This seems pretty straightforward, we just need  to ensure that <code>func4_ret</code> == 10</p>
<p>The first call to <code>func4()</code> is here</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>func4_ret <span style="color:#f92672">=</span> <span style="color:#a6e22e">func4</span>(buff_1[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0xe</span>);
</span></span></code></pre></div><p>The parameters are</p>
<ul>
<li>First integer we input to the program</li>
<li>second is zero</li>
<li>third is E (14)</li>
</ul>
<p>Let&rsquo;s take a look into <code>func4()</code> to see how to get the return value we want</p>
<p><img src="img/func4_ghidra_view.png" alt="func4_ghidra_view"></p>
<p>We assign a local variable before proceeding with the &lsquo;if-else&rsquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>local_f4 <span style="color:#f92672">=</span> x <span style="color:#f92672">+</span> (e<span style="color:#f92672">-</span>x)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>
</span></span></code></pre></div><p>If we evaluate this using the parameters passed first, we get</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>local_f4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">+</span>(<span style="color:#ae81ff">14</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>
</span></span></code></pre></div><p>Next we have the conditional statement</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (first_input <span style="color:#f92672">&lt;</span> local_f4) {
</span></span><span style="display:flex;"><span>	iVarl <span style="color:#f92672">=</span> <span style="color:#a6e22e">func4</span>(first_input, x, local_f4 <span style="color:#f92672">+</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>	local_f4 <span style="color:#f92672">=</span> iVarl<span style="color:#f92672">+</span>local_f4;
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (local_f4 <span style="color:#f92672">&lt;</span> first_input) {
</span></span><span style="display:flex;"><span>	iVarl <span style="color:#f92672">=</span> <span style="color:#a6e22e">func4</span>(first_input, local_f4<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, e);
</span></span><span style="display:flex;"><span>	local_f4 <span style="color:#f92672">=</span> iVarl<span style="color:#f92672">+</span>local_f4;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>which will always check if our input is greater than or less than <code>local_f4</code> on the first pass through. As you probably noticed, this function makes recursive calls to itself in either case we take.</p>
<p>To cut straight to it, <code>local_f4</code> will always be 7 on the first pass, and we need to return from this function with the value 10, meaning we need a recursive call that will result in a return value of 3.</p>
<p>I will unashamedly admit this took me a while tracing through recursive calls by hand, but if we pass in an initial value of <strong>3</strong> we can trigger this by:</p>
<p><em>(I will plug in values rather than variables for readability)</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>local_f4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">+</span> (<span style="color:#ae81ff">14</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">7</span>) {
</span></span><span style="display:flex;"><span>	iVarl <span style="color:#f92672">=</span> <span style="color:#a6e22e">func4</span>(<span style="color:#ae81ff">3</span>, x, <span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>	local_f4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span><span style="color:#f92672">+</span>iVarl
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This first call is ready to return 7, but it is waiting for the recursive branches to return. Here is the recursive call step-through</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>local_f4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">+</span> (<span style="color:#ae81ff">6</span><span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#ae81ff">3</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span>){
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#ae81ff">3</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span>){
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//input and local_f4 are equal, so we skip both conditionals
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">return</span> local_f4
</span></span></code></pre></div><p>Which will ultimately result in us returning back to <code>phase_4()</code>
with the value of 10 just as we needed.</p>
<p>Looking back at our last conditional statement,</p>
<p><img src="img/final_if_statement_ghidra.png" alt="final_if_statement_ghidra"></p>
<p>Since a == 10, we can see above that our input of &lsquo;3 10&rsquo; should successfully avoid all of the &lsquo;code mines&rsquo;, if you will.</p>
<p>Let&rsquo;s give it a shot</p>
<p><img src="img/phase_4_complete!.png" alt="phase_4_complete"></p>
<p>On to phase 5!</p>
    </div>
</div>

            </main>
        </div>


        <footer class="footer">
    
      <span>
        © 2025 Built by <a href="https://github.com/dav1dsec" class="footerLink">dav1dsec</a>
      </span>
    
  </footer>
    </div>

</body>

</html>
